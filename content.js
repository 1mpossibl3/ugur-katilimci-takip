const boostrap = () => {
  const btnContainer = document.querySelector(".tMdQNe");

  const btn = document.createElement("button");

  btn.classList.add("takeAttendanceBtn");

  btn.innerHTML = `<svg width="20" height="20" viewBox="0 0 568 569" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M230.133 2.05236C182 12.5857 145.867 45.919 132 92.719C127.6 107.519 126.133 131.919 128.667 147.652C137.067 200.319 176.133 241.119 229.333 252.986C242.133 255.786 267.733 255.786 281.2 252.852C330.533 242.186 369.467 203.252 380.133 153.919C383.067 140.452 383.067 114.852 380.267 102.052C370.133 56.719 339.067 21.2524 296.667 6.71903C277.067 0.052363 248.8 -1.94764 230.133 2.05236ZM278.133 60.5857C305.467 70.0524 323.467 93.919 325.6 123.386C326.933 143.919 320 162.052 304.667 177.519C280.667 201.919 244 205.386 214.933 186.186C204.533 179.252 197.2 170.719 191.2 158.052C170.133 114.319 197.6 64.319 246.667 56.8524C254.133 55.7857 269.333 57.519 278.133 60.5857Z" fill="white"/>
                      <path d="M173.333 285.519C131.467 290.986 91.8667 309.919 61.7333 338.452C37.0667 362.052 19.8667 388.852 9.46667 420.186C0.533333 446.986 0 451.519 0 503.519V550.186L3.33333 555.119C5.2 557.919 9.06667 561.786 11.8667 563.786L17.0667 567.386L174 567.786L330.8 568.052L336.8 564.986C345.867 560.186 350.533 552.586 351.067 541.652C351.6 530.586 348 522.719 339.467 516.719L333.733 512.719L194.933 512.052L56 511.386L55.6 496.719C55.3333 488.586 55.8667 476.052 56.6667 468.852C63.4667 409.252 103.2 362.586 161.333 345.652L173.333 342.186L248.667 341.652C302.267 341.386 326.933 341.652 334 342.719C354.533 346.052 373.2 353.519 393.333 366.719C404.4 373.919 409.6 375.386 418.933 374.319C437.067 372.319 447.867 350.319 438.933 333.252C433.067 322.186 400.933 302.719 374.4 294.052C346.267 284.986 346.4 284.986 260.667 284.586C217.733 284.452 178.533 284.852 173.333 285.519Z" fill="white"/>
                      <path d="M527.333 400.852C524.533 402.052 508.933 416.452 488.4 437.119L454.133 471.252L433.067 450.452C415.2 432.852 411.067 429.386 406 428.052C384.4 422.186 365.333 439.919 370 461.386C371.6 468.586 372.267 469.386 404.4 501.919C425.6 523.119 439.2 535.919 442.667 537.519C449.2 540.586 457.733 540.719 464.4 538.052C471.2 535.252 561.333 445.519 564.8 438.052C568 431.252 568 422.186 564.8 415.386C562.267 409.652 554.4 402.052 549.067 399.919C544.133 398.052 532.667 398.586 527.333 400.852Z" fill="white"/>
                    </svg>
`;

  btn.onclick = () => {
    const participants = [...document.querySelectorAll(".XEazBc.adnwBd")]
      .filter((e) => e.innerText !== e.dataset.selfName)
      .map((e) => e.innerText);
    chrome.runtime.sendMessage(
      { message: "setParticipants", data: participants },
      () => {
        chrome.runtime.sendMessage({ message: "openPopup" }, () => {});
      }
    );
  };

  btnContainer.appendChild(btn);
};

new MutationObserver((mutations, me) => {
  if (document.querySelector(".c8mVDd")) {
    console.log("Meet page loaded");
    boostrap();
    me.disconnect();
  }
}).observe(document.querySelector(".crqnQb"), {
  childList: true,
  subtree: true,
});
